const questions = [
  // Complete list of 25 questions, as provided earlier
];

let currentQuestionIndex = 0;
let incorrectAttempts = 0;
let correctAttempts = 0;
let randomizedOptions = [];
let correctOptionIndex = 0;
let selectedQuestions = [];
let maxQuestions = 8;

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function startQuiz() {
  document.getElementById('intro-container').classList.add('hidden');
  document.getElementById('quiz-container').classList.remove('hidden');
  shuffle(questions);
  selectedQuestions = questions.slice(0, maxQuestions); // Select 8 random questions
  loadQuestion();
  updateProgressBar(); // Initialize progress bar
}

function loadQuestion() {
  const questionData = selectedQuestions[currentQuestionIndex];
  
  // Shuffle options and track correct answer position
  randomizedOptions = [...questionData.options];
  shuffle(randomizedOptions);
  correctOptionIndex = randomizedOptions.indexOf(questionData.correct);
  
  const container = document.getElementById('question-container');
  container.innerHTML = `
    <p>${questionData.question}</p>
    <ul>
      ${randomizedOptions.map((option, index) => `<li><button onclick="checkAnswer(${index})">${String.fromCharCode(65 + index)}) ${option}</button></li>`).join('')}
    </ul>
  `;

  updateProgressBar(); // Update progress bar on each question
}

function checkAnswer(selectedIndex) {
  if (selectedIndex === correctOptionIndex) {
    correctAttempts++;
    document.getElementById('feedback-correct').classList.remove('hidden');
    document.getElementById('feedback-incorrect').classList.add('hidden');
    document.getElementById('expanded-info').classList.add('hidden');
  } else {
    incorrectAttempts++;
    correctAttempts--;
    document.getElementById('feedback-correct').classList.add('hidden');
    document.getElementById('feedback-incorrect').classList.remove('hidden');
  }
}

function showExplanation() {
  const questionData = selectedQuestions[currentQuestionIndex];
  document.getElementById('feedback-incorrect').classList.add('hidden');
  document.getElementById('expanded-info').classList.remove('hidden');
  document.getElementById('expanded-text').innerText = questionData.explanation;
}

function retry() {
  document.getElementById('feedback-correct').classList.add('hidden');
  document.getElementById('expanded-info').classList.add('hidden');
  document.getElementById('feedback-incorrect').classList.add('hidden');
  loadQuestion();
}

function nextQuestion() {
  currentQuestionIndex++;
  if (currentQuestionIndex < selectedQuestions.length) {
    document.getElementById('feedback-correct').classList.add('hidden');
    loadQuestion();
  } else {
    endQuiz();
  }
}

function updateProgressBar() {
  const progress = ((currentQuestionIndex + 1) / maxQuestions) * 100;
  document.getElementById('progress-bar').style.width = `${progress}%`;
}

function endQuiz() {
  const endMessage = document.getElementById('end-message');
  endMessage.classList.remove('hidden');
  
  if (correctAttempts === 8) {
    endMessage.innerHTML = `
      <p>Well done! You got ${correctAttempts} out of 8 correct!</p>
      <p>You've aced the quiz!</p>
      <div class="confetti">ðŸŽ‰</div>
      <script>confettiEffect();</script>
    `;
  } else if (correctAttempts >= 6) {
    endMessage.innerHTML = `
      <p>Great work! You got ${correctAttempts} out of 8 correct!</p>
      <p>You're nearly there!</p>
      <div class="balloons">
        <img src="balloon1.png" alt="Balloon">
        <img src="balloon2.png" alt="Balloon">
      </div>
    `;
  } else {
    endMessage.innerHTML = `
      <p>Don't worry! You got ${correctAttempts} out of 8 correct.</p>
      <p>Keep practicing and try the quiz again!</p>
    `;
  }
}
